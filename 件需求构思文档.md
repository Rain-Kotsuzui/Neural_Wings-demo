
# 软件需求构思文档：跨平台高性能空战竞技系统

## 1. 背景介绍

飞行模拟与空战竞技类软件（如 DCS World, War Thunder）长期以来拥有固定的硬核用户群体。然而，现有的该类软件普遍存在“重客户端”的问题：它们依赖庞大的本地资源包（动辄数十 GB）、高昂的硬件配置（独立显卡）以及繁琐的安装过程。这导致了极高的用户准入门槛。

另一方面，随着 WebAssembly (WASM) 和 WebGL 2.0 技术的成熟，浏览器已具备运行高性能原生 C++ 代码的能力。但目前的网页游戏（Web Games）大多仍停留在轻量级、2D 休闲的层面，缺乏能够提供低延迟、高帧率、物理拟真体验的 3D 竞技平台。

本项目旨在开发一个名为 **“Neural Wings”** 的跨平台空战竞技系统。利用 C++ 的高性能特性与 WebAssembly 的跨平台能力，打破端游与页游的界限，为用户提供“即点即玩”、媲美原生客户端体验的 3D 空战服务。

## 2. 欲解决问题

当前空战类游戏及 Web 端 3D 应用主要存在以下技术与应用痛点：
1.  **Web 端高性能计算缺失**：传统 JS/TS 开发的 Web 3D 应用在处理大量物理碰撞（如弹幕、碎片）时性能瓶颈明显，难以维持竞技所需的 60FPS 帧率。
2.  **网络延迟与协议限制**：浏览器环境原生不支持 UDP 协议，基于 TCP 的 WebSocket 在弱网环境下存在“队头阻塞”问题，导致实时竞技游戏出现严重的画面卡顿和操作延迟。
3.  **跨平台体验割裂**：用户无法在桌面端（追求极致画质）和网页端（追求便捷）之间无缝切换，数据互通困难。
4.  **准入门槛过高**：传统空战软件对硬件要求极高，阻碍了轻度用户的体验。

## 3. 软件创意

本系统通过引入**“C++ Native First”**的开发理念与**异构网络架构**，解决上述问题：
1.  **原生级 Web 体验**：核心逻辑与渲染引擎采用 C++ 编写，通过 Emscripten 编译为 WASM。这使得软件能在浏览器中直接调用 GPU 硬件加速，并在端侧运行复杂的物理模拟，无需高配电脑即可流畅运行 Low Poly 风格的 3D 画面。
2.  **WebRTC 模拟 UDP 通信**：在 Web 端创新性地集成 `libdatachannel`，利用 WebRTC 的 Data Channel 构建不可靠、无序传输通道，突破浏览器的 TCP 限制，将网络延迟降低至毫秒级。
3.  **双端融合架构**：一套 C++ 核心代码库，通过条件编译同时生成 Web 网页版和 Windows 桌面版。桌面端使用原生 UDP (ENet)，Web 端使用 WebRTC，两者接入同一个后端服务，实现真正的跨端同服竞技。

## 4. 系统的组成和部署

本系统由以下三个主要部分组成：

*   **客户端 (Client)**：
    *   **Web 端**：基于 Raylib 引擎的 WASM 模块，运行于 Chrome/Edge 等现代浏览器中，负责渲染与逻辑计算。
    *   **Desktop 端**：基于同一套源码编译的 Windows 可执行程序 (.exe)，提供更极致的性能。
*   **服务端 (Server)**：
    *   **游戏网关**：C++ 编写的高并发服务器，负责处理异构网络协议（同时监听 UDP 端口和 WebRTC 信令）。
    *   **业务服务**：处理 HTTP 请求，管理用户资产与匹配逻辑。
*   **数据基础设施**：
    *   **Redis**：缓存房间状态、玩家 Session 及实时排行榜。
    *   **MySQL**：持久化存储用户账号、战机改装方案及战绩历史。

## 5. 软件系统的功能描述

本系统的用例主要包括以下功能模块：

1.  **实时空战竞技**：
    *   **飞行模拟**：基于空气动力学的 6 自由度飞行控制（俯仰、滚转、偏航）。
    *   **战斗系统**：机炮弹道计算、导弹锁定与追踪、物理碰撞检测。
    *   **环境交互**：程序化生成的无限地形、体积云渲染、尾流湍流模拟。
2.  **机库养成系统**：
    *   **战机改装**：用户可消耗游戏币购买并更换引擎、机翼、武器挂载，改装结果直接影响飞行物理参数。
    *   **3D 预览**：在机库中旋转查看战机的 Low Poly 模型细节。
3.  **多人联机服务**：
    *   **房间管理**：创建房间、快速匹配、房间列表查询。
    *   **状态同步**：基于“服务器权威 + 客户端预测”架构的位置同步。
    *   **网络优化**：通过 WebRTC Data Channel 实现低延迟、高吞吐量的数据传输。
4.  **用户与社交**：
    *   **账号体系**：注册、登录、战绩查询。
    *   **排行榜**：查看全服击坠数排名。
    *   **好友系统**：添加好友、好友排行榜。
    *   **聊天系统**：房间内实时聊天。

## 6. 可行性及潜在风险
**技术可行性**：
本项目采用业界前沿但成熟的技术方案。Raylib 提供了优秀的 WASM 支持；WebRTC Data Channel 已成为云游戏的主流传输标准；C++ 后端的高性能特性足以支撑实时战斗。

**拟采用的技术栈**：
*   **前端/客户端核心**：Modern C++, Raylib (渲染), RayGui (UI)
*   **Web 运行时**：Emscripten (WASM 编译器)
*   **网络通信**：
    *   Web端：libdatachannel (基于 WebRTC 的 C++ 实现)
    *   Desktop端：ENet (可靠 UDP 库)
*   **后端服务**：C++ (自定义游戏服务器框架)
*   **数据库**：MySQL 8.0, Redis
*   **部署工具**：Docker & Docker Compose, Nginx, GitHub Actions。

**组内成员技能与分工**：


**预期成果**：
*   完成核心逻辑与渲染引擎的 WASM 编译与测试。
*   完成基于 WebRTC 的低延迟网络通信模块。
**潜在风险**：
1.  **技术门槛风险**：C++ 内存管理复杂，且 WebRTC 协议栈集成难度较大。
    *   *对策*：利用 CMake 进行模块化管理，优先跑通最小可行性 Demo（Echo Server）。
2.  **调试困难**：WASM 在浏览器中的调试不如本地 C++ 方便。
    *   *对策*：利用“桌面端开发，Web 端发布”的策略，大部分逻辑 Bug 在 Windows 本地调试解决。