{
  "version": "2.0.0",
  "tasks": [
    //debug
    {
      "label": "Ensure Build Dir",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-Command",
        "if (-not (Test-Path '${workspaceFolder}/build')) { Write-Host 'Build NOT exists!.' -ForegroundColor Yellow; cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug } else { Write-Host 'Build ready' -ForegroundColor Green }"
      ],
      "problemMatcher": "$msCompile"
    },
    {
      "label": "CMake Build",
      "type": "shell",
      "command": "cmake",
      "args": [
        "--build",
        "${workspaceFolder}/build",
        "--config",
        "Debug"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "dependsOn": "Ensure Build Dir",
      "problemMatcher": "$gcc"
    },
    {
      "label": "Build All (UI + Debug)",
      "dependsOrder": "sequence",
      "dependsOn": [
        "UI: Build",
        "CMake Build"
      ],
      "problemMatcher": []
    },
    {
      "label": "Super Clean (Desktop)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-Command",
        "Remove-Item -Path '${workspaceFolder}/build' -Recurse -Force"
      ],
      "problemMatcher": "$msCompile"
    },
    //release
    {
      "label": "CMake Build Release",
      "type": "shell",
      "command": "cmake",
      "args": [
        "--build",
        "${workspaceFolder}/build",
        "--config",
        "Release"
      ],
      "dependsOn": "Ensure Build Dir",
      "problemMatcher": "$msCompile"
    },
    //web
    {
      "label": "Start Web Server",
      "type": "shell",
      "command": "python",
      "args": [
        "-m",
        "http.server",
        "8000",
        "--directory",
        "build_web"
      ],
      "isBackground": true,
      "dependsOrder": "sequence",
      "dependsOn": [
        "UI: Build",
        "Web Build"
      ],
      "problemMatcher": {
        "owner": "python",
        "pattern": {
          "regexp": "^Serving HTTP on"
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^Serving HTTP on",
          "endsPattern": "^Serving HTTP on"
        }
      }
    },
    {
      "label": "Web Build",
      "type": "shell",
      "command": "cmake",
      "args": [
        "--build",
        "build_web"
      ],
      "group": "build",
      "dependsOn": "Web Configure",
      "problemMatcher": "$gcc"
    },
    {
      "label": "Web Configure",
      "type": "shell",
      "command": "emcmake",
      "args": [
        "cmake",
        "-B",
        "build_web",
        "-DPLATFORM=Web",
        "-DCMAKE_BUILD_TYPE=Release",
        "-G",
        "MinGW Makefiles"
      ],
      "group": "build",
      "dependsOn": [],
      "problemMatcher": []
    },
    {
      "label": "Super Clean (Web)",
      "type": "shell",
      "command": "powershell",
      "args": [
        "-Command",
        "Remove-Item -Path '${workspaceFolder}/build_web' -Recurse -Force"
      ],
      "problemMatcher": "$msCompile"
    },
    {
      "label": "UI: Install",
      "type": "shell",
      "command": "npm",
      "args": [
        "ci"
      ],
      "options": {
        "cwd": "${workspaceFolder}/ui"
      },
      "problemMatcher": []
    },
    {
      "label": "UI: Dev",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "dev"
      ],
      "options": {
        "cwd": "${workspaceFolder}/ui"
      },
      "problemMatcher": []
    },
    {
      "label": "UI: Build",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "build"
      ],
      "options": {
        "cwd": "${workspaceFolder}/ui"
      },
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "UI: Preview",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "preview"
      ],
      "options": {
        "cwd": "${workspaceFolder}/ui"
      },
      "problemMatcher": []
    },
    {
      "label": "Tools: Preprocess GIF Textures",
      "type": "shell",
      "command": "${workspaceFolder}/tools/.venv/Scripts/python.exe",
      "args": [
        "${workspaceFolder}/tools/preprocess_gif_textures.py",
        "--dir",
        "${workspaceFolder}/assets/textures/gif"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    }
  ]
}
